---
phase: 04.5-project-homepage-organization
plan: 03
type: execute
wave: 2
depends_on: ["04.5-01", "04.5-02"]
files_modified:
  - package.json
  - src/renderer/stores/projectStore.ts
  - src/renderer/stores/queueStore.ts
  - src/renderer/stores/jdStore.ts
  - src/renderer/App.tsx
  - src/renderer/routes/Dashboard.tsx
  - src/renderer/routes/ProjectView.tsx
autonomous: true

must_haves:
  truths:
    - "React Router (MemoryRouter) handles navigation between dashboard and project views"
    - "projectStore manages project list and active project selection"
    - "queueStore reloads CVs when activeProjectId changes"
    - "jdStore reloads JDs when activeProjectId changes"
    - "Dashboard route shows project list"
    - "ProjectView route shows existing queue/JD/editor layout scoped to project"
  artifacts:
    - path: "src/renderer/stores/projectStore.ts"
      provides: "Project state management"
      exports: ["useProjectStore"]
    - path: "src/renderer/routes/Dashboard.tsx"
      provides: "Homepage with project list"
      min_lines: 30
    - path: "src/renderer/routes/ProjectView.tsx"
      provides: "Project-scoped queue/JD/editor layout"
      min_lines: 30
  key_links:
    - from: "src/renderer/App.tsx"
      to: "src/renderer/routes/*"
      via: "MemoryRouter Routes"
    - from: "src/renderer/stores/queueStore.ts"
      to: "src/renderer/stores/projectStore.ts"
      via: "loadFromDatabase reads activeProjectId"
---

<objective>
Install React Router, create project store, modify queue/JD stores for project filtering, and set up routing structure.

Purpose: Establish the navigation and state management foundation for multi-project workflow. Users navigate between dashboard (project list) and project view (existing UI scoped to project).

Output: React Router setup, projectStore, modified queueStore/jdStore, and route components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04.5-project-homepage-organization/04.5-RESEARCH.md
@src/renderer/App.tsx
@src/renderer/stores/queueStore.ts
@src/renderer/stores/jdStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install React Router and create project store</name>
  <files>package.json, src/renderer/stores/projectStore.ts, src/renderer/types/project.ts</files>
  <action>
1. Install react-router-dom:
```bash
npm install react-router-dom
```

2. Create `src/renderer/types/project.ts`:
```typescript
export interface Project {
  id: string;
  name: string;
  client_name: string | null;
  description: string | null;
  is_archived: boolean;
  created_at: string;
  updated_at: string;
  cv_count: number;
  jd_count: number;
}

export interface CreateProjectInput {
  name: string;
  client_name?: string;
  description?: string;
}
```

3. Create `src/renderer/stores/projectStore.ts`:
```typescript
import { create } from 'zustand';
import type { Project, CreateProjectInput } from '../types/project';

interface ProjectStore {
  projects: Project[];
  activeProjectId: string | null;
  isLoading: boolean;

  // Actions
  loadProjects: () => Promise<void>;
  selectProject: (id: string | null) => void;
  createProject: (input: CreateProjectInput) => Promise<string>;
  updateProject: (id: string, updates: Partial<CreateProjectInput & { is_archived: boolean }>) => Promise<boolean>;
  archiveProject: (id: string) => Promise<boolean>;
  deleteProject: (id: string) => Promise<boolean>;
}

export const useProjectStore = create<ProjectStore>((set, get) => ({
  projects: [],
  activeProjectId: null,
  isLoading: false,

  loadProjects: async () => {
    set({ isLoading: true });
    try {
      const result = await window.api.getAllProjects();
      if (result.success && result.data) {
        set({ projects: result.data });
      }
    } catch (error) {
      console.error('Failed to load projects:', error);
    } finally {
      set({ isLoading: false });
    }
  },

  selectProject: (id) => {
    set({ activeProjectId: id });
    // Note: Components will trigger store reloads via useEffect when activeProjectId changes
  },

  createProject: async (input) => {
    const result = await window.api.createProject(input);
    if (result.success && result.data) {
      await get().loadProjects();
      return result.data.id;
    }
    throw new Error(result.error || 'Failed to create project');
  },

  updateProject: async (id, updates) => {
    const result = await window.api.updateProject(id, updates);
    if (result.success) {
      await get().loadProjects();
      return true;
    }
    return false;
  },

  archiveProject: async (id) => {
    return get().updateProject(id, { is_archived: true });
  },

  deleteProject: async (id) => {
    const result = await window.api.deleteProject(id);
    if (result.success) {
      const { activeProjectId } = get();
      if (activeProjectId === id) {
        set({ activeProjectId: null });
      }
      await get().loadProjects();
      return true;
    }
    return false;
  },
}));

// Expose store for E2E testing
if (typeof window !== 'undefined') {
  (window as unknown as { __projectStore: typeof useProjectStore }).__projectStore = useProjectStore;
}
```
  </action>
  <verify>
- `npm install` completes successfully
- react-router-dom in package.json dependencies
- src/renderer/types/project.ts exists with Project interface
- src/renderer/stores/projectStore.ts exists with all methods
- TypeScript compiles without errors
  </verify>
  <done>React Router installed and projectStore created with CRUD actions</done>
</task>

<task type="auto">
  <name>Task 2: Modify queueStore and jdStore for project filtering</name>
  <files>src/renderer/stores/queueStore.ts, src/renderer/stores/jdStore.ts</files>
  <action>
1. Update `src/renderer/stores/queueStore.ts` loadFromDatabase to accept and use projectId:
```typescript
import { useProjectStore } from './projectStore';

// In the store definition:
loadFromDatabase: async () => {
  try {
    const projectId = useProjectStore.getState().activeProjectId;
    const result = await window.api.getAllCVs(projectId || undefined);
    if (result.success && result.data) {
      const items: QueueItem[] = result.data.map((cv) => ({
        id: cv.id,
        fileName: cv.file_name,
        fileType: cv.file_name.split('.').pop()?.toLowerCase() || 'unknown',
        filePath: cv.file_path || '',
        status: 'completed' as QueueStatus,
        parseConfidence: cv.parse_confidence,
        createdAt: cv.created_at,
      }));
      set({ items });
    }
  } catch (err) {
    console.error('Failed to load CVs from database:', err);
  }
},
```

2. Update `src/renderer/stores/jdStore.ts` loadJDs to use projectId:
```typescript
import { useProjectStore } from './projectStore';

// In the store definition:
loadJDs: async () => {
  try {
    const projectId = useProjectStore.getState().activeProjectId;
    const result = await window.api.getAllJDs(projectId || undefined);
    if (result.success && result.data) {
      set({ jds: result.data as JDSummary[] });
    }
  } catch (err) {
    console.error('Failed to load JDs:', err);
  }
},
```

Note: The actual reload trigger will be handled in the ProjectView component via useEffect.
  </action>
  <verify>
- TypeScript compiles without errors
- queueStore.loadFromDatabase uses projectStore.activeProjectId
- jdStore.loadJDs uses projectStore.activeProjectId
  </verify>
  <done>queueStore and jdStore filter data by activeProjectId from projectStore</done>
</task>

<task type="auto">
  <name>Task 3: Create routing structure and route components</name>
  <files>src/renderer/App.tsx, src/renderer/routes/Dashboard.tsx, src/renderer/routes/ProjectView.tsx</files>
  <action>
1. Create `src/renderer/routes/Dashboard.tsx` (minimal placeholder for now, UI in Plan 04):
```typescript
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useProjectStore } from '../stores/projectStore';
import { Button } from '../components/ui/button';

export function Dashboard() {
  const navigate = useNavigate();
  const { projects, isLoading, loadProjects, createProject } = useProjectStore();

  useEffect(() => {
    loadProjects();
  }, [loadProjects]);

  const handleCreateProject = async () => {
    try {
      const id = await createProject({ name: 'New Project' });
      navigate(`/project/${id}`);
    } catch (error) {
      console.error('Failed to create project:', error);
    }
  };

  const handleOpenProject = (id: string) => {
    navigate(`/project/${id}`);
  };

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-full">
        <p className="text-muted-foreground">Loading projects...</p>
      </div>
    );
  }

  return (
    <div className="p-6">
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-2xl font-bold">Projects</h1>
        <Button onClick={handleCreateProject}>New Project</Button>
      </div>

      {projects.length === 0 ? (
        <div className="text-center py-12">
          <p className="text-muted-foreground mb-4">No projects yet</p>
          <Button onClick={handleCreateProject}>Create your first project</Button>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {projects.map((project) => (
            <div
              key={project.id}
              className="p-4 border border-border rounded-lg cursor-pointer hover:border-primary transition-colors"
              onClick={() => handleOpenProject(project.id)}
            >
              <h3 className="font-medium">{project.name}</h3>
              {project.client_name && (
                <p className="text-sm text-muted-foreground">{project.client_name}</p>
              )}
              <div className="flex gap-4 mt-2 text-sm text-muted-foreground">
                <span>{project.cv_count} CVs</span>
                <span>{project.jd_count} JDs</span>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
```

2. Create `src/renderer/routes/ProjectView.tsx`:
```typescript
import { useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { QueueTabs } from '../components/queue/QueueTabs';
import { CVEditor } from '../components/editor/CVEditor';
import { ErrorDetailPanel } from '../components/editor/ErrorDetailPanel';
import { JDPanel } from '../components/jd/JDPanel';
import { LLMSettings } from '../components/settings/LLMSettings';
import { Button } from '../components/ui/button';
import { useQueueStore } from '../stores/queueStore';
import { useEditorStore } from '../stores/editorStore';
import { useJDStore } from '../stores/jdStore';
import { useProjectStore } from '../stores/projectStore';

export function ProjectView() {
  const { id: projectId } = useParams<{ id: string }>();
  const navigate = useNavigate();

  const loadFromDatabase = useQueueStore((state) => state.loadFromDatabase);
  const loadJDs = useJDStore((state) => state.loadJDs);
  const viewMode = useEditorStore((state) => state.viewMode);
  const { selectProject, projects } = useProjectStore();

  const [showSettings, setShowSettings] = useState(false);

  // Get current project info
  const currentProject = projects.find((p) => p.id === projectId);

  // Set active project and reload data when project changes
  useEffect(() => {
    if (projectId) {
      selectProject(projectId);
    }
  }, [projectId, selectProject]);

  // Reload CVs and JDs when project is selected
  useEffect(() => {
    if (projectId) {
      loadFromDatabase();
      loadJDs();
    }
  }, [projectId, loadFromDatabase, loadJDs]);

  const isPanelOpen = viewMode !== null || showSettings;

  return (
    <div className="h-screen flex flex-col bg-background">
      {/* Header */}
      <header className="flex items-center justify-between px-4 py-2 border-b border-border">
        <div className="flex items-center gap-4">
          <Button
            variant="ghost"
            size="sm"
            onClick={() => {
              selectProject(null);
              navigate('/');
            }}
          >
            ‚Üê Dashboard
          </Button>
          <div>
            <h1 className="text-lg font-bold text-primary">
              {currentProject?.name || 'Project'}
            </h1>
            {currentProject?.client_name && (
              <p className="text-xs text-muted-foreground">{currentProject.client_name}</p>
            )}
          </div>
        </div>
        <Button
          variant="outline"
          size="sm"
          onClick={() => setShowSettings(!showSettings)}
        >
          {showSettings ? 'Close Settings' : 'Settings'}
        </Button>
      </header>

      {/* Main content - three column layout (unchanged from current App.tsx) */}
      <main className="flex-1 overflow-hidden flex">
        {/* Queue panel - left side */}
        <div data-testid="queue-panel" className={`border-r border-border ${isPanelOpen ? 'w-1/3' : 'w-1/2'}`}>
          <QueueTabs />
        </div>

        {/* JD panel - middle */}
        <div data-testid="jd-panel" className={`border-r border-border ${isPanelOpen ? 'w-1/3' : 'w-1/2'}`}>
          <JDPanel />
        </div>

        {/* Detail panel - right side (CV editor, error details, or settings) */}
        {showSettings && (
          <div className="w-1/3 border-l border-border">
            <div className="p-4 border-b border-border">
              <h2 className="text-sm font-medium text-foreground">Settings</h2>
            </div>
            <LLMSettings />
          </div>
        )}
        {!showSettings && viewMode === 'cv' && (
          <div className="w-1/3">
            <CVEditor />
          </div>
        )}
        {!showSettings && viewMode === 'error' && (
          <div className="w-1/3">
            <ErrorDetailPanel />
          </div>
        )}
      </main>
    </div>
  );
}

// Add missing import at top
import { useState } from 'react';
```

3. Update `src/renderer/App.tsx` to use MemoryRouter:
```typescript
import { MemoryRouter, Routes, Route } from 'react-router-dom';
import { Dashboard } from './routes/Dashboard';
import { ProjectView } from './routes/ProjectView';
import './styles/globals.css';

export function App() {
  return (
    <MemoryRouter initialEntries={['/']}>
      <div className="h-screen flex flex-col bg-background">
        <Routes>
          <Route path="/" element={<Dashboard />} />
          <Route path="/project/:id" element={<ProjectView />} />
        </Routes>
      </div>
    </MemoryRouter>
  );
}
```

Note: Remove the old App.tsx content entirely and replace with the router setup. The previous queue/JD/editor layout is now in ProjectView.tsx.
  </action>
  <verify>
- TypeScript compiles without errors
- src/renderer/routes/Dashboard.tsx exists
- src/renderer/routes/ProjectView.tsx exists
- App.tsx uses MemoryRouter with routes to Dashboard and ProjectView
- Navigating to / shows Dashboard
- Navigating to /project/:id shows ProjectView with existing queue/JD layout
  </verify>
  <done>Routing structure in place with Dashboard and ProjectView routes, project-scoped data loading</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without TypeScript errors
2. App launches and shows Dashboard with project list (should show Default Project if Plan 01 ran)
3. Clicking a project navigates to ProjectView
4. ProjectView shows the existing queue/JD/editor layout
5. CVs and JDs shown are filtered to the selected project
6. "Dashboard" button in header navigates back to /
</verification>

<success_criteria>
- React Router MemoryRouter handles navigation without URL changes
- projectStore manages project list and selection
- queueStore and jdStore filter by activeProjectId
- Dashboard shows project list with create button
- ProjectView shows existing UI scoped to selected project
- Navigation works: dashboard <-> project view
</success_criteria>

<output>
After completion, create `.planning/phases/04.5-project-homepage-organization/04.5-03-SUMMARY.md`
</output>
