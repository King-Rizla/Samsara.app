---
phase: 10-outreach-workflow-engine
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/renderer/components/outreach/OutreachSection.tsx
  - src/renderer/components/outreach/KanbanBoard.tsx
  - src/renderer/components/outreach/KanbanColumn.tsx
  - src/renderer/components/outreach/CandidateCard.tsx
  - src/renderer/components/outreach/CandidatePanel.tsx
  - src/renderer/components/outreach/GraduationControls.tsx
  - src/renderer/stores/workflowStore.ts
  - src/renderer/components/candidates/CandidateSearchSection.tsx
autonomous: false

must_haves:
  truths:
    - "Recruiter sees Kanban board with 6 columns: Pending, Contacted, Replied, Screening, Passed, Failed"
    - "Candidate cards show name, match %, current stage, and last message snippet"
    - "Clicking a card opens side panel with full candidate details and timeline"
    - "Recruiter can drag cards to valid destination columns for manual overrides"
    - "Recruiter can graduate individual candidates from Candidate Search with a button"
    - "Recruiter can batch-graduate selected candidates with checkboxes"
    - "Graduated candidates show badge in Candidate Search and appear in Outreach Kanban"
  artifacts:
    - path: "src/renderer/components/outreach/KanbanBoard.tsx"
      provides: "Drag-and-drop Kanban pipeline view"
      min_lines: 100
    - path: "src/renderer/components/outreach/CandidateCard.tsx"
      provides: "Draggable candidate card with info display"
      min_lines: 50
    - path: "src/renderer/components/outreach/CandidatePanel.tsx"
      provides: "Side panel with full candidate details"
      min_lines: 80
    - path: "src/renderer/stores/workflowStore.ts"
      provides: "Zustand store for workflow candidates and actions"
      exports: ["useWorkflowStore"]
  key_links:
    - from: "src/renderer/components/outreach/KanbanBoard.tsx"
      to: "src/renderer/stores/workflowStore.ts"
      via: "uses useWorkflowStore for candidates and actions"
      pattern: "useWorkflowStore"
    - from: "src/renderer/stores/workflowStore.ts"
      to: "window.api"
      via: "calls IPC methods for graduation and events"
      pattern: "window.api.graduateCandidate|sendWorkflowEvent"
---

<objective>
Build the Kanban pipeline dashboard UI with drag-and-drop, candidate cards, side panel, and graduation controls in Candidate Search.

Purpose: The dashboard is how recruiters interact with the automated outreach workflow. They need to see candidates flowing through the pipeline, manually override states when needed, and graduate candidates from the search results into the outreach sequence.

Output:

- Kanban board with 6 columns using @dnd-kit
- Candidate cards with key info and actions
- Side panel for detailed candidate view
- Graduation button and batch selection in Candidate Search
- Workflow store connecting UI to backend
  </objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-outreach-workflow-engine/10-RESEARCH.md
@.planning/phases/10-outreach-workflow-engine/10-CONTEXT.md
@.planning/phases/10-outreach-workflow-engine/10-01-SUMMARY.md
@src/renderer/components/outreach/OutreachSection.tsx
@src/renderer/stores/outreachStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create workflow store and Kanban board structure</name>
  <files>
    src/renderer/stores/workflowStore.ts
    src/renderer/components/outreach/KanbanBoard.tsx
    src/renderer/components/outreach/KanbanColumn.tsx
  </files>
  <action>
    1. Create src/renderer/stores/workflowStore.ts (Zustand):

    Define WorkflowCandidate interface:
    ```typescript
    interface WorkflowCandidate {
      id: string;           // candidateId (same as cvId)
      name: string;
      matchScore: number;
      status: string;       // Current workflow state
      phone?: string;
      email?: string;
      contactedAt?: string;
      repliedAt?: string;
      lastMessageSnippet?: string;
      lastMessageAt?: string;
    }
    ```

    Store state:
    - candidates: WorkflowCandidate[]
    - selectedCandidateId: string | null
    - isLoading: boolean
    - isPanelOpen: boolean

    Store actions:
    - loadCandidates(projectId): Call window.api.getWorkflowsByProject, map to WorkflowCandidate[], set candidates
    - selectCandidate(id): Set selectedCandidateId, open panel
    - closePanel(): Set isPanelOpen = false, clear selection
    - moveCandidateToColumn(candidateId, newStatus): Optimistic update, call sendWorkflowEvent with mapped event type
    - graduateCandidate(candidateId, projectId, context): Call window.api.graduateCandidate, refresh candidates
    - graduateBatch(candidateIds, projectId, timeoutMs): Call window.api.graduateCandidates, refresh
    - pauseWorkflow(candidateId): sendWorkflowEvent('PAUSE')
    - resumeWorkflow(candidateId): sendWorkflowEvent('RESUME')
    - cancelWorkflow(candidateId): sendWorkflowEvent('CANCEL')
    - forceCall(candidateId): sendWorkflowEvent('FORCE_CALL')

    Event mapping for drag-drop:
    - pending -> contacted: GRADUATE
    - contacted -> paused: PAUSE
    - contacted -> archived: CANCEL
    - contacted -> screening: SKIP_TO_SCREENING
    - paused -> contacted: RESUME
    - paused -> screening: FORCE_CALL
    - paused -> archived: CANCEL

    2. Create src/renderer/components/outreach/KanbanBoard.tsx:

    Import from @dnd-kit/core: DndContext, DragOverlay, closestCorners, PointerSensor, KeyboardSensor, useSensor, useSensors
    Import from @dnd-kit/sortable: SortableContext, sortableKeyboardCoordinates, verticalListSortingStrategy

    Define COLUMNS constant:
    ```typescript
    const COLUMNS = [
      { id: 'pending', title: 'Pending', color: 'bg-slate-500/20' },
      { id: 'contacted', title: 'Contacted', color: 'bg-blue-500/20' },
      { id: 'replied', title: 'Replied', color: 'bg-purple-500/20' },
      { id: 'screening', title: 'Screening', color: 'bg-amber-500/20' },
      { id: 'passed', title: 'Passed', color: 'bg-green-500/20' },
      { id: 'failed', title: 'Failed', color: 'bg-red-500/20' },
    ];
    ```

    Component:
    - Use useWorkflowStore for candidates and moveCandidateToColumn
    - Set up sensors (PointerSensor, KeyboardSensor)
    - Track activeId state for drag overlay
    - handleDragStart: Set activeId
    - handleDragEnd: Validate transition (use VALID_TRANSITIONS map), call moveCandidateToColumn
    - Render DndContext with columns, each column gets filtered candidates
    - DragOverlay shows CandidateCard for active candidate

    3. Create src/renderer/components/outreach/KanbanColumn.tsx:

    Props: id, title, count, color, children
    - useDroppable from @dnd-kit/core
    - Render column header with title and count badge
    - Render children (SortableContext wraps cards)
    - Visual feedback when dragging over (isOver state)
    - Styling: w-64 min-w-64, flex-shrink-0, rounded-lg border

  </action>
  <verify>
    - npx tsc --noEmit passes
    - workflowStore.ts exports useWorkflowStore
    - KanbanBoard.tsx imports and uses @dnd-kit
    - KanbanColumn.tsx uses useDroppable
  </verify>
  <done>
    Workflow store manages candidate state and provides actions for graduation and workflow events. Kanban board renders 6 columns with drag-and-drop support using @dnd-kit. Columns show header with count and highlight on drag-over.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create candidate card and side panel components</name>
  <files>
    src/renderer/components/outreach/CandidateCard.tsx
    src/renderer/components/outreach/CandidatePanel.tsx
  </files>
  <action>
    1. Create src/renderer/components/outreach/CandidateCard.tsx:

    Import useSortable from @dnd-kit/sortable, CSS from @dnd-kit/utilities

    Props: candidate: WorkflowCandidate, isDragging?: boolean

    Component:
    - useSortable with candidate.id
    - Apply transform and transition styles
    - Click handler: Call useWorkflowStore.selectCandidate

    Card layout (per CONTEXT.md):
    - Name (truncated if long)
    - Match % badge (prominent, color-coded: green >80%, yellow 60-80%, red <60%)
    - Last message snippet (truncated, text-muted-foreground)
    - Contact icons (Phone icon if has phone, Mail icon if has email)
    - Timestamp of last activity (relative time: "2h ago")

    Actions overflow menu (DropdownMenu):
    - Primary action varies by state (e.g., "Graduate" for pending, "Pause" for contacted)
    - Menu items: Pause, Resume, Skip to Screening, Force Call, Send Message, Archive
    - Only show valid actions for current state

    Styling:
    - Card: bg-card border rounded-lg p-3 shadow-sm hover:shadow-md transition cursor-grab
    - When isDragging: opacity-50, ring-2 ring-primary

    2. Create src/renderer/components/outreach/CandidatePanel.tsx:

    Props: candidateId: string | null, onClose: () => void

    Component:
    - If no candidateId, render nothing or placeholder
    - Load full candidate data including messages timeline
    - Use Sheet component (already exists in codebase) for slide-out panel

    Panel sections:
    - Header: Name, match %, status badge, close button
    - Contact info: Phone, email with copy buttons
    - Quick actions: Button row for state transitions (contextual to current state)
    - Message timeline: Reuse CandidateTimeline component from Phase 9
    - Send message button: Opens SendMessageDialog

    Layout:
    - Sheet from right side, width 400px (sm:max-w-md)
    - Scrollable content area
    - Fixed header and action bar

    Connect to workflow store for actions (pause, resume, cancel, forceCall)

  </action>
  <verify>
    - npx tsc --noEmit passes
    - CandidateCard.tsx uses useSortable and renders candidate info
    - CandidatePanel.tsx uses Sheet and shows timeline
    - Card shows match % badge and overflow menu
  </verify>
  <done>
    Candidate cards are draggable, show key info (name, match %, snippet), and have contextual action menus. Side panel shows full candidate details with timeline and action buttons.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate Kanban into OutreachSection and add graduation to CandidateSearch</name>
  <files>
    src/renderer/components/outreach/OutreachSection.tsx
    src/renderer/components/outreach/GraduationControls.tsx
    src/renderer/components/candidates/CandidateSearchSection.tsx
  </files>
  <action>
    1. Update src/renderer/components/outreach/OutreachSection.tsx:

    Replace current list-based layout with Kanban board:
    - Import KanbanBoard, CandidatePanel, useWorkflowStore
    - Load candidates on mount: useEffect -> workflowStore.loadCandidates(projectId)
    - Start reply polling on mount (window.api.startReplyPolling), stop on unmount
    - Render KanbanBoard as main content
    - Render CandidatePanel as overlay (Sheet)
    - Keep header with Templates and Communication buttons

    Layout:
    - Header bar (existing)
    - KanbanBoard fills remaining space (flex-1 overflow-x-auto)
    - CandidatePanel slides from right when candidate selected

    2. Create src/renderer/components/outreach/GraduationControls.tsx:

    Props: selectedIds: string[], projectId: string, onGraduated: () => void

    Component:
    - Show count of selected candidates
    - "Graduate Selected" button (disabled if none selected)
    - On click: Call window.api.graduateCandidates, show toast on success, call onGraduated

    3. Update src/renderer/components/candidates/CandidateSearchSection.tsx:

    Add graduation UI per CONTEXT.md decisions:
    - Add checkbox to each candidate card (for batch selection)
    - Track selectedCandidateIds in component state
    - Add "Graduate" button to individual candidate cards (per card action)
    - Add GraduationControls above/below candidate list for batch graduation
    - Show "Graduated" badge on candidates where outreach_status === 'graduated'
    - Add toggle filter: "Hide graduated" (default: show all)

    Individual graduation:
    - Button on card: "Graduate to Outreach"
    - Calls window.api.graduateCandidate with candidate data
    - On success: Refresh candidates list, show toast

    Batch graduation:
    - Checkboxes on cards, "Select all" in header
    - GraduationControls component shows when any selected
    - Respects match % threshold if configured (future: agent instruction)

    Visual feedback:
    - Graduated candidates have Badge variant="secondary" showing "Graduated"
    - Graduated candidates appear dimmed or have different border color

  </action>
  <verify>
    - npx tsc --noEmit passes
    - npm test passes
    - OutreachSection renders KanbanBoard
    - CandidateSearchSection has graduation buttons and checkboxes
    - Graduated badge appears on graduated candidates
  </verify>
  <done>
    OutreachSection displays Kanban pipeline with candidate cards and side panel. CandidateSearchSection has individual graduation buttons and batch selection with GraduationControls. Graduated candidates show badge and can be filtered.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Kanban pipeline dashboard for outreach workflow with:
    - 6-column Kanban board (Pending, Contacted, Replied, Screening, Passed, Failed)
    - Draggable candidate cards showing name, match %, last message snippet
    - Side panel with full candidate details and message timeline
    - Graduation controls in Candidate Search (individual + batch)
    - "Graduated" badge on graduated candidates
  </what-built>
  <how-to-verify>
    1. Start the app: `npm start`
    2. Navigate to a project with some processed CVs
    3. Go to Candidate Search section
    4. Verify: Each candidate card has a checkbox and "Graduate" button
    5. Select multiple candidates using checkboxes
    6. Verify: GraduationControls appears showing count of selected
    7. Click "Graduate Selected" on one or more candidates
    8. Verify: Toast shows success, candidates now show "Graduated" badge
    9. Navigate to Outreach section (click Outreach on Samsara Wheel)
    10. Verify: Kanban board shows with 6 columns
    11. Verify: Graduated candidates appear in "Contacted" column (they were auto-advanced on graduation)
    12. Click a candidate card
    13. Verify: Side panel opens showing name, contact info, timeline
    14. Try dragging a card from Contacted to Paused
    15. Verify: Card moves to Paused column
    16. Verify: Invalid drags (e.g., Passed to Pending) are rejected
    17. In side panel, click Pause/Resume/Cancel buttons
    18. Verify: Candidate moves to appropriate column
  </how-to-verify>
  <resume-signal>Type "approved" if Kanban UI works correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Run these checks to verify the plan is complete:

1. TypeScript compilation:

   ```bash
   npx tsc --noEmit
   ```

2. Test suite:

   ```bash
   npm test
   ```

3. Lint:

   ```bash
   npx eslint --ext .ts,.tsx src/renderer/components/outreach/
   ```

4. Manual verification (covered in checkpoint)
   </verification>

<success_criteria>

- Kanban board displays 6 columns with correct headers and colors
- Candidates appear in correct columns based on workflow state
- Drag-and-drop moves candidates and triggers workflow events
- Side panel shows full candidate details with timeline
- Graduation works from Candidate Search (individual and batch)
- Graduated candidates show badge and filter toggle works
- All TypeScript compiles without errors
- All existing tests pass
  </success_criteria>

<output>
After completion, create `.planning/phases/10-outreach-workflow-engine/10-03-SUMMARY.md`
</output>
