---
phase: 06-bulk-processing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/index.ts
  - src/main/preload.ts
  - src/renderer/components/queue/DropZone.tsx
  - src/renderer/types/cv.ts
autonomous: true

must_haves:
  truths:
    - "User can drag-drop a folder onto DropZone and all PDF/DOCX/DOC files within are discovered recursively"
    - "A confirmation dialog shows the count of discovered files before processing begins"
    - "Files trickle into the Submitted tab as they are enqueued (not all at once)"
    - "A soft warning toast appears when 200+ files are dropped"
    - "Non-matching files in the folder are silently ignored"
    - "Individual file failures do not stop the batch"
  artifacts:
    - path: "src/main/index.ts"
      provides: "batch-enqueue IPC handler that accepts paths, stats folders, scans recursively, shows confirmation dialog, enqueues in chunks"
      contains: "batch-enqueue"
    - path: "src/main/preload.ts"
      provides: "batchEnqueue API bridge method"
      contains: "batchEnqueue"
    - path: "src/renderer/components/queue/DropZone.tsx"
      provides: "Folder drop detection — sends all dropped paths to main process via batchEnqueue"
      contains: "batchEnqueue"
  key_links:
    - from: "src/renderer/components/queue/DropZone.tsx"
      to: "src/main/index.ts"
      via: "window.api.batchEnqueue IPC call"
      pattern: "window\\.api\\.batchEnqueue"
    - from: "src/main/index.ts"
      to: "src/main/queueManager.ts"
      via: "queueManager.enqueue() called per discovered file"
      pattern: "queueManager\\.enqueue"
---

<objective>
Add folder drag-drop support to DropZone with recursive file scanning and batch IPC.

Purpose: Enable users to drop a folder containing 100+ CVs and have them all queued for processing automatically, using the existing queue infrastructure.

Output: Updated DropZone that handles folder drops, a new `batch-enqueue` IPC handler in main process that recursively scans folders, shows a confirmation dialog, and enqueues files in chunks of 25.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-bulk-processing/06-CONTEXT.md
@.planning/phases/06-bulk-processing/06-RESEARCH.md
@src/main/queueManager.ts
@src/main/index.ts
@src/main/preload.ts
@src/renderer/components/queue/DropZone.tsx
@src/renderer/stores/queueStore.ts
@src/renderer/types/cv.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add batch-enqueue IPC handler in main process</name>
  <files>src/main/index.ts, src/main/preload.ts, src/renderer/types/cv.ts</files>
  <action>
    1. In `src/main/index.ts`, add a new IPC handler `batch-enqueue` that:
       - Accepts an array of file paths (strings) and an optional projectId
       - For each path, calls `fs.stat()` to determine if it's a file or directory
       - For directories, recursively scans using `fs.readdir` with `{ recursive: true }` (Node 20+) to find all `.pdf`, `.docx`, `.doc` files at any depth
       - For individual files, checks extension and includes if valid
       - After scanning, if file count > 0, shows an Electron `dialog.showMessageBox` confirmation: "Found X CVs (.pdf, .docx, .doc). Process all?" with OK/Cancel buttons
       - If file count >= 200, append to message: "This may take a while."
       - If user confirms, enqueues files in chunks of 25 using `queueManager.enqueue()` with a 50ms `setTimeout` delay between chunks to allow IPC status updates to flush to renderer (files trickle into Submitted tab)
       - Returns `{ success: true, fileCount: N }` or `{ success: false, error: string }`
       - Import `fs/promises` and `path` at the top of the file
       - Use `BrowserWindow.getFocusedWindow()` as parent for the dialog

    2. In `src/main/preload.ts`, add the `batchEnqueue` method to the API object:
       ```typescript
       batchEnqueue: (paths: string[], projectId?: string): Promise<{ success: boolean; fileCount?: number; error?: string }> =>
         ipcRenderer.invoke('batch-enqueue', paths, projectId),
       ```

    3. In `src/renderer/types/cv.ts`, add `batchEnqueue` to the `ElectronAPI` interface:
       ```typescript
       batchEnqueue: (paths: string[], projectId?: string) => Promise<{ success: boolean; fileCount?: number; error?: string }>;
       ```

  </action>
  <verify>
    - `npx tsc --noEmit` passes with no type errors
    - The `batch-enqueue` handler exists in index.ts
    - The preload bridge exposes `batchEnqueue`
  </verify>
  <done>
    batch-enqueue IPC handler accepts paths, recursively scans folders for CV files, shows confirmation dialog, and enqueues files in chunks of 25 with trickle delays. Preload bridge and types are wired.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update DropZone to handle folder drops</name>
  <files>src/renderer/components/queue/DropZone.tsx</files>
  <action>
    Update the `handleDrop` function in DropZone.tsx:

    1. Instead of filtering files client-side, collect ALL dropped paths (files and folders) and send them to the main process via `window.api.batchEnqueue(paths, activeProjectId)`. The main process handles folder detection, recursive scanning, confirmation dialog, and enqueuing.

    2. The new flow:
       - On drop, collect all file paths from `e.dataTransfer.files` using `window.electronFile.getPath(file)`
       - If only individual files with valid extensions are dropped (no folders detected — check if any path lacks an extension or use a heuristic), fall through to existing per-file `processFile` logic for backward compatibility
       - If ANY entry could be a folder (heuristic: no file extension), send ALL paths to `window.api.batchEnqueue()` and let the main process sort it out
       - Actually, simplest approach per CONTEXT: always send to batchEnqueue when more than 1 file is dropped OR when any path has no extension. For single valid-extension files, keep existing `processFile` flow.

    3. After `batchEnqueue` returns, no further action needed — the existing `handleQueueStatusUpdate` listener in queueStore will receive status pushes from QueueManager as each file is enqueued and processed.

    4. Update the drop zone text to: "Drop CV files or folders here or click to select"

  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - DropZone.tsx calls `batchEnqueue` for folder/multi-file drops
    - Single file drops still use the existing `processFile` path
  </verify>
  <done>
    DropZone handles both individual file drops (existing path) and folder/multi-file drops (new batchEnqueue path). Folder contents are recursively scanned in the main process with confirmation dialog.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no type errors
2. `npx vitest run` — existing tests pass
3. Manual: Drop a folder with mixed file types → only PDF/DOCX/DOC are discovered, confirmation dialog appears, files trickle into Submitted tab
4. Manual: Drop 1 file → existing per-file flow still works
</verification>

<success_criteria>

- Folder drag-drop discovers all nested CV files recursively
- Confirmation dialog shows file count before processing
- Files appear in Submitted tab incrementally (not all at once)
- 200+ file warning appears in confirmation dialog
- Single file drops still work via existing path
- No type errors, existing tests pass
  </success_criteria>

<output>
After completion, create `.planning/phases/06-bulk-processing/06-01-SUMMARY.md`
</output>
