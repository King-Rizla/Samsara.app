---
phase: 14-mvp-packaging-and-release
plan: 04
type: execute
wave: 3
depends_on: ["14-01", "14-02", "14-03"]
files_modified:
  - package.json
autonomous: false

must_haves:
  truths:
    - "npm run make produces a Squirrel .exe installer on the mvp branch"
    - "PDF parser improvements from Plan 02 are on the mvp branch"
    - "Installer shows Samsara icon and product name"
  artifacts:
    - path: "out/make/squirrel.windows/x64/*.exe"
      provides: "Windows Squirrel installer"
  key_links:
    - from: "forge.config.ts"
      to: "out/make/"
      via: "electron-forge make pipeline"
      pattern: "MakerSquirrel"
---

<objective>
Cherry-pick PDF improvements to mvp branch, build the PyInstaller sidecar, run `npm run make` to produce the Windows installer, and verify the end-to-end result.

Purpose: This is the final assembly and verification — all prior plans feed into producing a working installer.
Output: A Squirrel .exe installer that installs Samsara with icon, shortcuts, and working PDF parsing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14-mvp-packaging-and-release/14-RESEARCH.md
@.planning/phases/14-mvp-packaging-and-release/14-01-SUMMARY.md
@.planning/phases/14-mvp-packaging-and-release/14-02-SUMMARY.md
@.planning/phases/14-mvp-packaging-and-release/14-03-SUMMARY.md
@forge.config.ts
@python-src/samsara.spec
</context>

<tasks>

<task type="auto">
  <name>Task 1: Cherry-pick PDF improvements and build installer</name>
  <files>package.json</files>
  <action>
    1. Ensure we're on the `mvp` branch: `git checkout mvp`

    2. Cherry-pick the PDF parser improvements from master (committed by Plan 02):
       ```bash
       git log master --oneline -- python-src/parsers/pdf_parser.py python-src/tests/test_pdf_resilience.py | head -5
       ```
       Cherry-pick the relevant commit(s) to mvp branch. Resolve any conflicts by keeping the mvp branch's structure.

    3. Add a convenience build script to package.json:
       Add `"prebuild:sidecar": "cd python-src && pyinstaller samsara.spec --noconfirm"` and
       `"build:installer": "npm run prebuild:sidecar && npx electron-forge make"`
       This documents the required build order.

    4. Build the Python sidecar:
       ```bash
       cd python-src && pyinstaller samsara.spec --noconfirm
       ```
       Verify `python-dist/samsara-backend/samsara-backend.exe` exists.

    5. Build the Electron installer:
       ```bash
       npx electron-forge make
       ```
       This should produce output in `out/make/squirrel.windows/x64/`.

    6. Verify the output:
       - Check that the installer .exe exists in `out/make/squirrel.windows/x64/`
       - Check installer size is > 100MB (indicates Python sidecar is included)
       - Check that `out/Samsara-win32-x64/resources/samsara-backend/samsara-backend.exe` exists in the packaged output

  </action>
  <verify>
    ```bash
    ls out/make/squirrel.windows/x64/*.exe
    ls out/Samsara-win32-x64/resources/samsara-backend/samsara-backend.exe 2>/dev/null || ls out/samsara-win32-x64/resources/samsara-backend/samsara-backend.exe 2>/dev/null
    ```
  </verify>
  <done>Squirrel installer .exe exists with Python sidecar bundled, installer size > 100MB</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete MVP installer: Squirrel .exe with Samsara icon, desktop/Start Menu shortcuts, Python sidecar, PDF parsing improvements, and first-run onboarding</what-built>
  <how-to-verify>
    1. Run the installer from `out/make/squirrel.windows/x64/` — it should show the Samsara icon during install
    2. After install, check for Desktop shortcut and Start Menu entry named "Samsara"
    3. Launch the app — it should NOT open DevTools
    4. Verify the onboarding card appears (no projects exist yet)
    5. Create a new project and upload a test PDF resume — verify it parses successfully
    6. If you have a previously-failing PDF, test it to check improved reliability
  </how-to-verify>
  <resume-signal>Type "approved" if installer works, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- Installer .exe exists in out/make/squirrel.windows/x64/
- Installer includes Python sidecar (file size > 100MB)
- Manual verification: installs, launches, parses PDFs, shows onboarding
</verification>

<success_criteria>
A working Squirrel .exe installer that installs Samsara with: app icon, desktop/Start Menu shortcuts, bundled Python sidecar, improved PDF parsing, and first-run onboarding overlay. User can install by double-clicking — no terminal required.
</success_criteria>

<output>
After completion, create `.planning/phases/14-mvp-packaging-and-release/14-04-SUMMARY.md`
</output>
