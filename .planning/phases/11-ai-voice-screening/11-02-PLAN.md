---
phase: 11-ai-voice-screening
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/components/settings/VoiceSettings.tsx
  - src/renderer/components/settings/SettingsView.tsx
  - src/main/screeningService.ts
  - src/main/index.ts
  - src/main/preload.ts
autonomous: true

must_haves:
  truths:
    - "User can enter ElevenLabs API key, agent ID, and phone number ID in settings"
    - "User can configure screening criteria per project (salary range, locations, availability)"
    - "Screening criteria are loaded when initiating calls"
    - "Test button validates ElevenLabs credentials"
  artifacts:
    - path: "src/renderer/components/settings/VoiceSettings.tsx"
      provides: "ElevenLabs credential input and test functionality"
      min_lines: 100
    - path: "src/main/screeningService.ts"
      provides: "Screening criteria storage and retrieval"
      exports: ["getScreeningCriteria", "saveScreeningCriteria"]
  key_links:
    - from: "src/renderer/components/settings/VoiceSettings.tsx"
      to: "src/main/credentialManager.ts"
      via: "IPC handlers for credential storage"
      pattern: "store-credential"
    - from: "src/main/voiceService.ts"
      to: "src/main/screeningService.ts"
      via: "Load criteria when building dynamic variables"
      pattern: "getScreeningCriteria"
---

<objective>
Create settings UI for ElevenLabs credentials and screening criteria configuration.

Purpose: Enable recruiters to configure voice screening by entering ElevenLabs credentials and defining screening criteria (salary expectations, allowed locations, availability requirements) that inform the AI's conversation and post-call analysis.

Output: VoiceSettings component for credential management, screening service for criteria storage, and IPC wiring.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-ai-voice-screening/11-CONTEXT.md
@.planning/phases/11-ai-voice-screening/11-RESEARCH.md
@src/renderer/components/settings/CommunicationSettings.tsx
@src/main/credentialManager.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create screening service for criteria management</name>
  <files>
    - src/main/screeningService.ts
    - src/main/index.ts
    - src/main/preload.ts
  </files>
  <action>
    Create src/main/screeningService.ts to manage screening criteria:

    ```typescript
    /**
     * Screening Service - Phase 11 AI Voice Screening
     *
     * Manages screening criteria per project. Criteria define thresholds
     * for pass/fail determination during post-call analysis.
     *
     * Per CONTEXT.md: 5 fixed question categories:
     * - Salary expectations
     * - Location/relocation
     * - Availability/start date
     * - Interest level
     * - Best contact details
     */

    import { getDatabase } from './database';
    import crypto from 'crypto';

    // Types
    export interface ScreeningCriteria {
      salaryMin?: number;
      salaryMax?: number;
      allowedLocations?: string[];  // List of acceptable locations
      requiresRelocation?: boolean;
      minimumNoticePeriod?: string; // e.g., "2 weeks", "1 month", "immediate"
      maximumNoticePeriod?: string; // e.g., "3 months"
      agentName?: string;           // Configurable AI name (default: Alex)
    }

    export interface ScreeningScript {
      id: string;
      projectId: string;
      agentName: string;
      systemPromptOverride?: string;
      firstMessageOverride?: string;
      criteria: ScreeningCriteria;
      createdAt: string;
      updatedAt: string;
    }

    interface ScreeningScriptRow {
      id: string;
      project_id: string;
      agent_name: string;
      system_prompt_override: string | null;
      first_message_override: string | null;
      criteria_json: string | null;
      created_at: string;
      updated_at: string;
    }

    /**
     * Get screening criteria for a project.
     * Returns default criteria if none configured.
     */
    export function getScreeningCriteria(projectId: string): ScreeningCriteria {
      const db = getDatabase();

      const row = db.prepare(`
        SELECT criteria_json FROM screening_scripts WHERE project_id = ? LIMIT 1
      `).get(projectId) as { criteria_json: string | null } | undefined;

      if (row?.criteria_json) {
        try {
          return JSON.parse(row.criteria_json) as ScreeningCriteria;
        } catch {
          console.warn('[ScreeningService] Failed to parse criteria JSON');
        }
      }

      // Return empty default criteria
      return {
        agentName: 'Alex',
      };
    }

    /**
     * Get full screening script for a project.
     */
    export function getScreeningScript(projectId: string): ScreeningScript | null {
      const db = getDatabase();

      const row = db.prepare(`
        SELECT * FROM screening_scripts WHERE project_id = ? LIMIT 1
      `).get(projectId) as ScreeningScriptRow | undefined;

      if (!row) return null;

      return {
        id: row.id,
        projectId: row.project_id,
        agentName: row.agent_name,
        systemPromptOverride: row.system_prompt_override || undefined,
        firstMessageOverride: row.first_message_override || undefined,
        criteria: row.criteria_json ? JSON.parse(row.criteria_json) : {},
        createdAt: row.created_at,
        updatedAt: row.updated_at,
      };
    }

    /**
     * Save screening criteria for a project.
     * Creates new script record or updates existing.
     */
    export function saveScreeningCriteria(
      projectId: string,
      criteria: ScreeningCriteria
    ): string {
      const db = getDatabase();
      const now = new Date().toISOString();

      // Check if script exists
      const existing = db.prepare(`
        SELECT id FROM screening_scripts WHERE project_id = ?
      `).get(projectId) as { id: string } | undefined;

      if (existing) {
        // Update existing
        db.prepare(`
          UPDATE screening_scripts SET
            criteria_json = ?,
            agent_name = ?,
            updated_at = ?
          WHERE id = ?
        `).run(
          JSON.stringify(criteria),
          criteria.agentName || 'Alex',
          now,
          existing.id
        );
        return existing.id;
      }

      // Create new
      const id = crypto.randomUUID();
      db.prepare(`
        INSERT INTO screening_scripts (
          id, project_id, agent_name, criteria_json, created_at, updated_at
        ) VALUES (?, ?, ?, ?, ?, ?)
      `).run(id, projectId, criteria.agentName || 'Alex', JSON.stringify(criteria), now, now);

      return id;
    }

    /**
     * Save full screening script for a project.
     */
    export function saveScreeningScript(
      projectId: string,
      script: Partial<Omit<ScreeningScript, 'id' | 'projectId' | 'createdAt' | 'updatedAt'>>
    ): string {
      const db = getDatabase();
      const now = new Date().toISOString();

      const existing = db.prepare(`
        SELECT id FROM screening_scripts WHERE project_id = ?
      `).get(projectId) as { id: string } | undefined;

      if (existing) {
        db.prepare(`
          UPDATE screening_scripts SET
            agent_name = COALESCE(?, agent_name),
            system_prompt_override = ?,
            first_message_override = ?,
            criteria_json = COALESCE(?, criteria_json),
            updated_at = ?
          WHERE id = ?
        `).run(
          script.agentName,
          script.systemPromptOverride || null,
          script.firstMessageOverride || null,
          script.criteria ? JSON.stringify(script.criteria) : null,
          now,
          existing.id
        );
        return existing.id;
      }

      const id = crypto.randomUUID();
      db.prepare(`
        INSERT INTO screening_scripts (
          id, project_id, agent_name, system_prompt_override, first_message_override,
          criteria_json, created_at, updated_at
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
      `).run(
        id,
        projectId,
        script.agentName || 'Alex',
        script.systemPromptOverride || null,
        script.firstMessageOverride || null,
        script.criteria ? JSON.stringify(script.criteria) : null,
        now,
        now
      );

      return id;
    }
    ```

    Add IPC handlers in src/main/index.ts:

    ```typescript
    import {
      getScreeningCriteria,
      saveScreeningCriteria,
      getScreeningScript,
      saveScreeningScript,
    } from './screeningService';

    // Screening criteria
    ipcMain.handle('get-screening-criteria', (_event, projectId: string) => {
      return getScreeningCriteria(projectId);
    });

    ipcMain.handle('save-screening-criteria', (_event, projectId: string, criteria: unknown) => {
      return saveScreeningCriteria(projectId, criteria as ScreeningCriteria);
    });

    ipcMain.handle('get-screening-script', (_event, projectId: string) => {
      return getScreeningScript(projectId);
    });

    ipcMain.handle('save-screening-script', (_event, projectId: string, script: unknown) => {
      return saveScreeningScript(projectId, script as Partial<ScreeningScript>);
    });
    ```

    Add to preload.ts:

    ```typescript
    getScreeningCriteria: (projectId: string) => ipcRenderer.invoke('get-screening-criteria', projectId),
    saveScreeningCriteria: (projectId: string, criteria: unknown) =>
      ipcRenderer.invoke('save-screening-criteria', projectId, criteria),
    getScreeningScript: (projectId: string) => ipcRenderer.invoke('get-screening-script', projectId),
    saveScreeningScript: (projectId: string, script: unknown) =>
      ipcRenderer.invoke('save-screening-script', projectId, script),
    ```

  </action>
  <verify>
    `npm run typecheck` passes.
    screeningService.ts exports all functions.
    IPC handlers registered in index.ts.
  </verify>
  <done>
    Screening service stores and retrieves criteria; IPC handlers wired.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create VoiceSettings component</name>
  <files>
    - src/renderer/components/settings/VoiceSettings.tsx
    - src/renderer/components/settings/SettingsView.tsx
  </files>
  <action>
    Create src/renderer/components/settings/VoiceSettings.tsx:

    ```typescript
    /**
     * VoiceSettings - ElevenLabs credential and screening configuration
     *
     * Allows users to:
     * - Enter ElevenLabs API key, agent ID, phone number ID
     * - Test credential validity
     * - Configure default screening criteria
     *
     * Per Phase 9 pattern: Uses credentialManager for secure storage.
     */

    import { useState, useEffect } from 'react';
    import { Loader2, CheckCircle, XCircle, Phone, User, Key, Settings2, MapPin, DollarSign, Clock } from 'lucide-react';
    import { toast } from 'sonner';
    import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../ui/card';
    import { Button } from '../ui/button';
    import { Input } from '../ui/input';
    import { Label } from '../ui/label';
    import { Separator } from '../ui/separator';

    interface VoiceSettingsProps {
      projectId?: string; // If provided, shows project-specific settings
    }

    interface ScreeningCriteria {
      salaryMin?: number;
      salaryMax?: number;
      allowedLocations?: string[];
      requiresRelocation?: boolean;
      minimumNoticePeriod?: string;
      maximumNoticePeriod?: string;
      agentName?: string;
    }

    export function VoiceSettings({ projectId }: VoiceSettingsProps) {
      // Credential state
      const [apiKey, setApiKey] = useState('');
      const [agentId, setAgentId] = useState('');
      const [phoneNumberId, setPhoneNumberId] = useState('');
      const [isTesting, setIsTesting] = useState(false);
      const [testResult, setTestResult] = useState<'success' | 'failure' | null>(null);
      const [isSavingCredentials, setIsSavingCredentials] = useState(false);

      // Screening criteria state
      const [criteria, setCriteria] = useState<ScreeningCriteria>({
        agentName: 'Alex',
      });
      const [isSavingCriteria, setIsSavingCriteria] = useState(false);
      const [locationsInput, setLocationsInput] = useState('');

      // Load existing credentials on mount
      useEffect(() => {
        loadCredentials();
        if (projectId) {
          loadCriteria();
        }
      }, [projectId]);

      const loadCredentials = async () => {
        try {
          // Load from credential manager (masks values)
          const storedApiKey = await window.electron.getCredential(null, 'elevenlabs', 'api_key');
          const storedAgentId = await window.electron.getCredential(projectId || null, 'elevenlabs', 'screening_agent_id');
          const storedPhoneId = await window.electron.getCredential(projectId || null, 'elevenlabs', 'phone_number_id');

          // Show placeholder if credentials exist
          if (storedApiKey) setApiKey('••••••••');
          if (storedAgentId) setAgentId(storedAgentId); // Agent IDs can be shown
          if (storedPhoneId) setPhoneNumberId(storedPhoneId); // Phone IDs can be shown
        } catch (error) {
          console.error('Failed to load credentials:', error);
        }
      };

      const loadCriteria = async () => {
        if (!projectId) return;
        try {
          const stored = await window.electron.getScreeningCriteria(projectId);
          setCriteria(stored || { agentName: 'Alex' });
          setLocationsInput(stored?.allowedLocations?.join(', ') || '');
        } catch (error) {
          console.error('Failed to load criteria:', error);
        }
      };

      const handleSaveCredentials = async () => {
        setIsSavingCredentials(true);
        try {
          // Only save non-placeholder values
          if (apiKey && apiKey !== '••••••••') {
            await window.electron.storeCredential(null, 'elevenlabs', 'api_key', apiKey);
          }
          if (agentId) {
            await window.electron.storeCredential(projectId || null, 'elevenlabs', 'screening_agent_id', agentId);
          }
          if (phoneNumberId) {
            await window.electron.storeCredential(projectId || null, 'elevenlabs', 'phone_number_id', phoneNumberId);
          }
          toast.success('ElevenLabs credentials saved');
          setTestResult(null);
        } catch (error) {
          console.error('Failed to save credentials:', error);
          toast.error('Failed to save credentials');
        } finally {
          setIsSavingCredentials(false);
        }
      };

      const handleTestConnection = async () => {
        setIsTesting(true);
        setTestResult(null);
        try {
          // Test by checking if voice is configured
          const isConfigured = await window.electron.isVoiceConfigured(projectId || null);
          if (isConfigured) {
            setTestResult('success');
            toast.success('ElevenLabs connection successful');
          } else {
            setTestResult('failure');
            toast.error('ElevenLabs credentials incomplete or invalid');
          }
        } catch (error) {
          setTestResult('failure');
          toast.error('Connection test failed');
        } finally {
          setIsTesting(false);
        }
      };

      const handleSaveCriteria = async () => {
        if (!projectId) {
          toast.error('Select a project to save screening criteria');
          return;
        }
        setIsSavingCriteria(true);
        try {
          const updatedCriteria: ScreeningCriteria = {
            ...criteria,
            allowedLocations: locationsInput
              .split(',')
              .map(s => s.trim())
              .filter(s => s.length > 0),
          };
          await window.electron.saveScreeningCriteria(projectId, updatedCriteria);
          setCriteria(updatedCriteria);
          toast.success('Screening criteria saved');
        } catch (error) {
          console.error('Failed to save criteria:', error);
          toast.error('Failed to save criteria');
        } finally {
          setIsSavingCriteria(false);
        }
      };

      return (
        <div className="space-y-6">
          {/* ElevenLabs Credentials */}
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Phone className="h-5 w-5" />
                ElevenLabs Voice AI
              </CardTitle>
              <CardDescription>
                Configure ElevenLabs Conversational AI for automated screening calls.
                {!projectId && ' These are global settings used across all projects.'}
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="apiKey" className="flex items-center gap-2">
                  <Key className="h-4 w-4" />
                  API Key
                </Label>
                <Input
                  id="apiKey"
                  type="password"
                  value={apiKey}
                  onChange={(e) => setApiKey(e.target.value)}
                  placeholder="Enter ElevenLabs API key"
                />
                <p className="text-xs text-muted-foreground">
                  Get your API key from{' '}
                  <a
                    href="https://elevenlabs.io/app/settings/api-keys"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-primary hover:underline"
                  >
                    ElevenLabs Settings
                  </a>
                </p>
              </div>

              <div className="space-y-2">
                <Label htmlFor="agentId" className="flex items-center gap-2">
                  <User className="h-4 w-4" />
                  Screening Agent ID
                </Label>
                <Input
                  id="agentId"
                  value={agentId}
                  onChange={(e) => setAgentId(e.target.value)}
                  placeholder="Enter agent ID"
                />
                <p className="text-xs text-muted-foreground">
                  Create a Conversational AI agent in the{' '}
                  <a
                    href="https://elevenlabs.io/app/conversational-ai"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-primary hover:underline"
                  >
                    ElevenLabs dashboard
                  </a>
                </p>
              </div>

              <div className="space-y-2">
                <Label htmlFor="phoneNumberId" className="flex items-center gap-2">
                  <Phone className="h-4 w-4" />
                  Phone Number ID
                </Label>
                <Input
                  id="phoneNumberId"
                  value={phoneNumberId}
                  onChange={(e) => setPhoneNumberId(e.target.value)}
                  placeholder="Enter phone number ID"
                />
                <p className="text-xs text-muted-foreground">
                  Import a Twilio phone number in ElevenLabs Agent Phone Numbers settings
                </p>
              </div>

              <div className="flex items-center gap-2 pt-2">
                <Button onClick={handleSaveCredentials} disabled={isSavingCredentials}>
                  {isSavingCredentials && <Loader2 className="h-4 w-4 mr-2 animate-spin" />}
                  Save Credentials
                </Button>
                <Button variant="outline" onClick={handleTestConnection} disabled={isTesting}>
                  {isTesting ? (
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                  ) : testResult === 'success' ? (
                    <CheckCircle className="h-4 w-4 mr-2 text-green-500" />
                  ) : testResult === 'failure' ? (
                    <XCircle className="h-4 w-4 mr-2 text-red-500" />
                  ) : null}
                  Test Connection
                </Button>
              </div>
            </CardContent>
          </Card>

          {/* Screening Criteria (project-specific) */}
          {projectId && (
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Settings2 className="h-5 w-5" />
                  Screening Criteria
                </CardTitle>
                <CardDescription>
                  Define pass/fail thresholds for this project. The AI will gather this information
                  and post-call analysis will use these criteria to determine outcomes.
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="space-y-2">
                  <Label htmlFor="agentName" className="flex items-center gap-2">
                    <User className="h-4 w-4" />
                    AI Agent Name
                  </Label>
                  <Input
                    id="agentName"
                    value={criteria.agentName || ''}
                    onChange={(e) => setCriteria({ ...criteria, agentName: e.target.value })}
                    placeholder="Alex"
                  />
                  <p className="text-xs text-muted-foreground">
                    The name the AI will use when introducing itself (per CONTEXT.md)
                  </p>
                </div>

                <Separator />

                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="salaryMin" className="flex items-center gap-2">
                      <DollarSign className="h-4 w-4" />
                      Minimum Salary
                    </Label>
                    <Input
                      id="salaryMin"
                      type="number"
                      value={criteria.salaryMin || ''}
                      onChange={(e) => setCriteria({
                        ...criteria,
                        salaryMin: e.target.value ? Number(e.target.value) : undefined
                      })}
                      placeholder="e.g., 50000"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="salaryMax" className="flex items-center gap-2">
                      <DollarSign className="h-4 w-4" />
                      Maximum Salary
                    </Label>
                    <Input
                      id="salaryMax"
                      type="number"
                      value={criteria.salaryMax || ''}
                      onChange={(e) => setCriteria({
                        ...criteria,
                        salaryMax: e.target.value ? Number(e.target.value) : undefined
                      })}
                      placeholder="e.g., 80000"
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="locations" className="flex items-center gap-2">
                    <MapPin className="h-4 w-4" />
                    Allowed Locations
                  </Label>
                  <Input
                    id="locations"
                    value={locationsInput}
                    onChange={(e) => setLocationsInput(e.target.value)}
                    placeholder="e.g., London, Manchester, Remote"
                  />
                  <p className="text-xs text-muted-foreground">
                    Comma-separated list of acceptable locations
                  </p>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="minNotice" className="flex items-center gap-2">
                      <Clock className="h-4 w-4" />
                      Min Notice Period
                    </Label>
                    <Input
                      id="minNotice"
                      value={criteria.minimumNoticePeriod || ''}
                      onChange={(e) => setCriteria({ ...criteria, minimumNoticePeriod: e.target.value })}
                      placeholder="e.g., immediate"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="maxNotice" className="flex items-center gap-2">
                      <Clock className="h-4 w-4" />
                      Max Notice Period
                    </Label>
                    <Input
                      id="maxNotice"
                      value={criteria.maximumNoticePeriod || ''}
                      onChange={(e) => setCriteria({ ...criteria, maximumNoticePeriod: e.target.value })}
                      placeholder="e.g., 3 months"
                    />
                  </div>
                </div>

                <div className="pt-2">
                  <Button onClick={handleSaveCriteria} disabled={isSavingCriteria}>
                    {isSavingCriteria && <Loader2 className="h-4 w-4 mr-2 animate-spin" />}
                    Save Criteria
                  </Button>
                </div>
              </CardContent>
            </Card>
          )}
        </div>
      );
    }
    ```

    Update SettingsView.tsx to add Voice tab:

    1. Import VoiceSettings: `import { VoiceSettings } from './VoiceSettings';`
    2. Add "voice" to the tabs list/enum
    3. Add Phone icon to the tab: `<Phone className="h-4 w-4" />`
    4. Add the VoiceSettings component in the tab content:
       ```tsx
       {activeTab === 'voice' && <VoiceSettings projectId={projectId} />}
       ```

    Follow the existing pattern in SettingsView.tsx for how CommunicationSettings is integrated.

  </action>
  <verify>
    `npm run typecheck` passes.
    VoiceSettings.tsx exists and exports VoiceSettings component.
    SettingsView shows Voice tab.
  </verify>
  <done>
    Users can configure ElevenLabs credentials and screening criteria in Settings.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire screening criteria to voice service</name>
  <files>
    - src/main/voiceService.ts
  </files>
  <action>
    Update src/main/voiceService.ts to load screening criteria when initiating calls:

    1. Import getScreeningCriteria from screeningService:
       ```typescript
       import { getScreeningCriteria, ScreeningCriteria } from './screeningService';
       ```

    2. Update initiateScreeningCall to load and use criteria:
       ```typescript
       export async function initiateScreeningCall(
         params: OutboundCallParams
       ): Promise<OutboundCallResult> {
         // ... existing credential checks ...

         try {
           // Load screening criteria for this project
           const criteria = getScreeningCriteria(params.projectId);

           // Build dynamic variables including criteria
           const dynamicVariables = buildDynamicVariables(params, criteria);

           // ... rest of function
         }
       }
       ```

    3. Update buildDynamicVariables to accept criteria:
       ```typescript
       function buildDynamicVariables(
         params: OutboundCallParams,
         criteria: ScreeningCriteria
       ): Record<string, string> {
         const vars: Record<string, string> = {
           candidate_name: params.candidateName,
           candidate_first_name: params.candidateName.split(' ')[0],
           role_title: params.roleTitle,
           company_name: params.companyName || 'our client',
           agent_name: criteria.agentName || 'Alex',
         };

         // Use criteria salary range if params doesn't have it
         const salaryMin = params.salaryRange?.min || criteria.salaryMin;
         const salaryMax = params.salaryRange?.max || criteria.salaryMax;

         if (salaryMin) {
           vars.salary_min = salaryMin.toLocaleString();
         }
         if (salaryMax) {
           vars.salary_max = salaryMax.toLocaleString();
         }
         if (params.location || criteria.allowedLocations?.length) {
           vars.job_location = params.location || criteria.allowedLocations?.[0] || '';
         }
         if (params.priorMessaging) {
           vars.prior_context = params.priorMessaging;
         }

         return vars;
       }
       ```

    This ensures the ElevenLabs agent has access to project-specific screening thresholds through dynamic variables, which can be used in the agent's system prompt for context-aware conversations.

  </action>
  <verify>
    `npm run typecheck` passes.
    voiceService imports and uses getScreeningCriteria.
  </verify>
  <done>
    Voice service loads project screening criteria when initiating calls.
  </done>
</task>

</tasks>

<verification>
Run these commands to verify the plan is complete:

```bash
# TypeScript compiles
npm run typecheck

# Tests pass
npm test

# New files exist
ls src/main/screeningService.ts src/renderer/components/settings/VoiceSettings.tsx

# App starts and shows Voice settings tab
npm start
```

Verify in the app:

1. Navigate to Settings
2. Voice tab is visible
3. Can enter ElevenLabs credentials
4. Test Connection button works (shows failure if no valid credentials)
5. If project selected, screening criteria section appears
   </verification>

<success_criteria>

- VoiceSettings.tsx renders ElevenLabs credential inputs
- Test Connection button validates credentials
- screeningService.ts stores/retrieves criteria from screening_scripts table
- voiceService.ts loads criteria when initiating calls
- SettingsView includes Voice tab
- IPC handlers for screening criteria work
  </success_criteria>

<output>
After completion, create `.planning/phases/11-ai-voice-screening/11-02-SUMMARY.md`
</output>
