---
phase: 08-samsara-wheel-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/App.tsx
  - src/renderer/routes/ProjectLayout.tsx
  - src/renderer/routes/ProjectView.tsx
  - src/renderer/components/sections/CandidateSearchSection.tsx
  - src/renderer/components/sections/PlaceholderSection.tsx
  - src/renderer/components/sections/SectionHeader.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "Navigating to /project/:id shows the project layout with Outlet rendering child routes"
    - "Navigating to /project/:id/search shows all M1 features (QueueTabs, JDPanel, CVEditor, JDDetail, ErrorDetailPanel, LLMSettings)"
    - "Store initialization (selectProject, loadFromDatabase, loadJDs) happens in ProjectLayout, not in section components"
    - "Back-to-dashboard navigation still works from ProjectLayout header"
    - "motion package is installed and importable"
  artifacts:
    - path: "src/renderer/routes/ProjectLayout.tsx"
      provides: "Layout route with Outlet, project store init, AnimatePresence wrapper"
      min_lines: 40
    - path: "src/renderer/components/sections/CandidateSearchSection.tsx"
      provides: "Extracted M1 features from ProjectView"
      min_lines: 30
    - path: "src/renderer/components/sections/PlaceholderSection.tsx"
      provides: "Coming Soon placeholder for unbuilt sections"
      min_lines: 15
    - path: "src/renderer/components/sections/SectionHeader.tsx"
      provides: "Back-to-wheel breadcrumb header"
      min_lines: 15
  key_links:
    - from: "src/renderer/App.tsx"
      to: "src/renderer/routes/ProjectLayout.tsx"
      via: "nested Route with Outlet"
      pattern: "Route.*ProjectLayout.*Outlet"
    - from: "src/renderer/routes/ProjectLayout.tsx"
      to: "stores (queueStore, jdStore, projectStore)"
      via: "useEffect calling selectProject, loadFromDatabase, loadJDs"
      pattern: "selectProject|loadFromDatabase|loadJDs"
---

<objective>
Refactor flat routing into nested routes with ProjectLayout, extract M1 features into CandidateSearchSection, and install the motion package.

Purpose: Establishes the routing foundation for the Samsara Wheel. The wheel view (Plan 02) and all section views need a shared project layout with store initialization. Without this refactor, the wheel has nowhere to live.

Output: Working nested routing with ProjectLayout wrapping an Outlet. CandidateSearchSection at /project/:id/search contains all existing M1 features. PlaceholderSection and SectionHeader ready for wheel navigation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-samsara-wheel-foundation/08-RESEARCH.md
@src/renderer/App.tsx
@src/renderer/routes/ProjectView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install motion and create section scaffold components</name>
  <files>
    package.json
    src/renderer/components/sections/SectionHeader.tsx
    src/renderer/components/sections/PlaceholderSection.tsx
  </files>
  <action>
1. Install motion: `npm install motion`

2. Create `src/renderer/components/sections/SectionHeader.tsx`:
   - Props: `{ title: string }`
   - Uses `useNavigate` and `useParams` from react-router-dom
   - Renders a bar with ArrowLeft button that navigates to `/project/${id}` (back to wheel)
   - Separator div and title text
   - Follow the pattern from 08-RESEARCH.md Code Examples section
   - Use existing Button component from `../ui/button`
   - Use ArrowLeft from lucide-react

3. Create `src/renderer/components/sections/PlaceholderSection.tsx`:
   - Props: `{ name: string; accentColor?: string }`
   - Renders SectionHeader with the section name
   - Below header: centered "Coming Soon" message with the section name
   - Use a subtle badge/pill with "Coming Soon" text
   - Style: muted foreground, centered vertically and horizontally in remaining space
     </action>
     <verify>
   - `npm ls motion` shows motion installed
   - Files exist at the specified paths
   - `npx tsc --noEmit` passes (no type errors in new files)
     </verify>
     <done>motion installed, SectionHeader renders back-to-wheel button, PlaceholderSection renders coming-soon with section name</done>
     </task>

<task type="auto">
  <name>Task 2: Create ProjectLayout, extract CandidateSearchSection, rewire routing</name>
  <files>
    src/renderer/routes/ProjectLayout.tsx
    src/renderer/components/sections/CandidateSearchSection.tsx
    src/renderer/routes/ProjectView.tsx
    src/renderer/App.tsx
  </files>
  <action>
1. Create `src/renderer/routes/ProjectLayout.tsx`:
   - Import Outlet, useParams, useNavigate, useLocation from react-router-dom
   - Import motion, AnimatePresence from 'motion/react'
   - Import stores: useQueueStore (loadFromDatabase), useJDStore (loadJDs, clearActiveJD), useProjectStore (selectProject, projects), useEditorStore (viewMode)
   - Import ArrowLeft, Settings from lucide-react, Button from ui/button
   - Extract the project header bar from ProjectView (back-to-dashboard button, project name display, settings toggle) into this component
   - useEffect: on projectId change, call selectProject(projectId), clearActiveJD(), loadFromDatabase(), loadJDs() — same logic currently in ProjectView
   - Render: project header bar, then AnimatePresence mode="wait" wrapping a motion.div keyed on `isWheelView ? 'wheel' : location.pathname` containing `<Outlet />`
   - isWheelView detection: `location.pathname.match(/^\/project\/[^/]+$/)`
   - motion.div: initial={{ opacity: 0, scale: 0.95 }}, animate={{ opacity: 1, scale: 1 }}, exit={{ opacity: 0, scale: 0.95 }}, transition={{ duration: 0.3, ease: 'easeInOut' }}
   - The settings button and LLMSettings panel should stay in ProjectLayout (it's project-level, not section-level). Move the showSettings state here and render LLMSettings conditionally alongside the Outlet.
   - CRITICAL: Do NOT wrap Outlet in React.memo (Pitfall 3 from research)

2. Create `src/renderer/components/sections/CandidateSearchSection.tsx`:
   - Import SectionHeader from './SectionHeader'
   - Import QueueTabs, CVEditor, ErrorDetailPanel, JDPanel, JDDetail from existing component paths
   - Import useEditorStore for viewMode
   - Render: SectionHeader with title "Candidate Search", then the main content area
   - Copy the main content layout from ProjectView (the 3-panel flex layout with QueueTabs, JDPanel, and the conditional right panel for CVEditor/ErrorDetailPanel/JDDetail)
   - Do NOT include LLMSettings here (stays in ProjectLayout)
   - Do NOT include store initialization here (moved to ProjectLayout)

3. Refactor `src/renderer/routes/ProjectView.tsx`:
   - Strip it down to become the wheel view (index route for /project/:id)
   - For now (before Plan 02 builds the actual wheel), render a simple centered placeholder: "Samsara Wheel - Coming in Plan 02"
   - Remove all store imports and initialization (moved to ProjectLayout)
   - Remove the project header bar (moved to ProjectLayout)
   - This becomes the WheelView — keep it minimal as Plan 02 will replace the content

4. Update `src/renderer/App.tsx` routing:
   - Import ProjectLayout from './routes/ProjectLayout'
   - Import CandidateSearchSection from './components/sections/CandidateSearchSection'
   - Import PlaceholderSection from './components/sections/PlaceholderSection'
   - Replace flat `<Route path="/project/:id" element={<ProjectView />} />` with nested routes:
     ```
     <Route path="/project/:id" element={<ProjectLayout />}>
       <Route index element={<ProjectView />} />
       <Route path="search" element={<CandidateSearchSection />} />
       <Route path="outreach" element={<PlaceholderSection name="Candidate Outreach" />} />
       <Route path="coordination" element={<PlaceholderSection name="Client Coordination" />} />
       <Route path="data-entry" element={<PlaceholderSection name="Data Entry" />} />
       <Route path="business-dev" element={<PlaceholderSection name="Business Development" />} />
     </Route>
     ```
   - Keep MemoryRouter — it works fine with nested routes in Electron
   - Add wildcard support: change `<Route path="/project/:id"` to `<Route path="/project/:id/*"` if needed for nested route matching (test this — react-router v7 may handle it automatically)

5. IMPORTANT: Update any sidebar navigation that currently navigates to `/project/:id` — it should continue to work (lands on index route = wheel view). The existing sidebar uses `navigate(`/project/${id}`)` which will hit the index route correctly.
   </action>
   <verify> - `npx tsc --noEmit` passes - `npx vitest run` — existing tests pass (or failures are pre-existing, not caused by this refactor) - Manual check: navigating to a project shows the ProjectLayout header - `/project/:id` shows the wheel placeholder - `/project/:id/search` shows all M1 features (QueueTabs, JDPanel, CVEditor)
   </verify>
   <done> - ProjectLayout renders project header and Outlet with AnimatePresence - CandidateSearchSection contains all M1 features (QueueTabs, JDPanel, CVEditor, ErrorDetailPanel, JDDetail) - ProjectView is a minimal wheel placeholder - All 6 nested routes configured in App.tsx - Store initialization (selectProject, loadFromDatabase, loadJDs) lives in ProjectLayout
   </done>
   </task>

</tasks>

<verification>
1. `npm ls motion` — motion installed
2. `npx tsc --noEmit` — no type errors
3. `npx vitest run` — tests pass
4. App starts with `npm start` — navigating to a project shows ProjectLayout header, index route shows wheel placeholder
5. Navigating to /project/:id/search shows QueueTabs + JDPanel + right panel (CVEditor/JDDetail/ErrorDetailPanel)
</verification>

<success_criteria>

- Nested routing works: /project/:id (wheel placeholder), /project/:id/search (M1 features), /project/:id/outreach|coordination|data-entry|business-dev (placeholder sections)
- All M1 features functional in CandidateSearchSection (CV parsing, JD matching, branding, bulk processing)
- AnimatePresence transitions fire on route changes
- Store initialization happens once in ProjectLayout, not duplicated in sections
- motion package installed and importable from 'motion/react'
  </success_criteria>

<output>
After completion, create `.planning/phases/08-samsara-wheel-foundation/08-01-SUMMARY.md`
</output>
