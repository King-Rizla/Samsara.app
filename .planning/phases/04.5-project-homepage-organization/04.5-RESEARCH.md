# Phase 4.5: Project Homepage & Organization - Research

**Researched:** 2026-01-27
**Domain:** React multi-view architecture, SQLite schema migration, dashboard UI
**Confidence:** HIGH

## Summary

This phase adds a homepage dashboard with project organization to enable multi-project workflows. The existing queue/editor/JD-matching UI remains unchanged inside projects. Research identified three main implementation areas:

1. **Routing**: Use MemoryRouter (react-router-dom) for client-side navigation between dashboard and project views. HashRouter is an alternative but MemoryRouter is cleaner for Electron apps without URL requirements.

2. **Database Schema**: Add a `projects` table with foreign key references from `cvs`, `job_descriptions`, and `cv_jd_matches`. Use SQLite's `PRAGMA user_version` for schema versioning with `ALTER TABLE ADD COLUMN` migrations.

3. **UI Components**: Install shadcn/ui Sidebar and Card components. Use a simple layout with collapsible sidebar (~200px), stats strip, and project card grid. The shadcn Sidebar component (variant "icon") supports collapsing to icons-only.

**Primary recommendation:** Implement routing with React Router MemoryRouter, add project_id columns via schema migration, and compose the dashboard from shadcn/ui Sidebar + Card components with minimal custom styling.

## Standard Stack

### Core

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| react-router-dom | ^7.x | Client-side routing | Standard React routing, supports MemoryRouter for Electron |
| zustand | 5.x (installed) | State management | Already used, add projectStore for project selection |
| better-sqlite3 | 12.x (installed) | Database with migrations | Already used, supports PRAGMA user_version |

### Supporting

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| shadcn/ui sidebar | latest | Collapsible sidebar navigation | Dashboard layout |
| shadcn/ui card | latest | Project cards, stats cards | Dashboard grid display |
| shadcn/ui dialog | latest | Project creation modal | Optional inline creation fallback |
| lucide-react | 0.563 (installed) | Icons for sidebar nav items | Already available |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| MemoryRouter | HashRouter | Hash shows in title bar; MemoryRouter is cleaner for Electron |
| Zustand multi-store | Single store with slices | Project isolation favors separate stores per concern |
| Custom sidebar | shadcn Sidebar | shadcn provides accessibility, collapse, responsive for free |

**Installation:**
```bash
# React Router (not yet installed)
npm install react-router-dom

# shadcn components (add to existing setup)
npx shadcn@latest add sidebar card dialog scroll-area separator tooltip
```

**CSS Variables for Sidebar (add to globals.css):**
```css
:root {
  --sidebar: 0 0% 5%;
  --sidebar-foreground: 0 0% 100%;
  --sidebar-primary: 280 100% 60%;
  --sidebar-primary-foreground: 0 0% 100%;
  --sidebar-accent: 0 0% 15%;
  --sidebar-accent-foreground: 0 0% 100%;
  --sidebar-border: 0 0% 20%;
  --sidebar-ring: 280 100% 60%;
}
```

## Architecture Patterns

### Recommended Project Structure
```
src/renderer/
├── App.tsx                      # SidebarProvider + Router wrapper
├── routes/
│   ├── Dashboard.tsx            # Homepage with stats + project grid
│   └── ProjectView.tsx          # Existing queue/JD/editor layout
├── components/
│   ├── sidebar/
│   │   └── AppSidebar.tsx       # Navigation sidebar
│   ├── dashboard/
│   │   ├── StatsStrip.tsx       # Horizontal stats cards
│   │   ├── ProjectCard.tsx      # Individual project card
│   │   └── ProjectGrid.tsx      # Grid of project cards
│   └── ... (existing)
├── stores/
│   ├── projectStore.ts          # NEW: Project selection, list, CRUD
│   ├── queueStore.ts            # Modified: Filter by activeProjectId
│   ├── jdStore.ts               # Modified: Filter by activeProjectId
│   └── editorStore.ts           # Unchanged
```

### Pattern 1: MemoryRouter for Electron

**What:** React Router without URL changes
**When to use:** Electron apps where URL is not visible to users
**Example:**
```typescript
// Source: react-router-dom documentation
import { MemoryRouter, Routes, Route } from 'react-router-dom';

function App() {
  return (
    <MemoryRouter initialEntries={['/']}>
      <Routes>
        <Route path="/" element={<Dashboard />} />
        <Route path="/project/:id" element={<ProjectView />} />
      </Routes>
    </MemoryRouter>
  );
}
```

### Pattern 2: Project-Scoped Zustand Store

**What:** Stores filter data by activeProjectId
**When to use:** When data needs isolation by project
**Example:**
```typescript
// Source: Zustand documentation
interface ProjectStore {
  projects: Project[];
  activeProjectId: string | null;

  loadProjects: () => Promise<void>;
  selectProject: (id: string) => void;
  createProject: (name: string, description?: string) => Promise<string>;
  archiveProject: (id: string) => Promise<void>;
  deleteProject: (id: string) => Promise<void>;
}

// In queueStore, filter by project
loadFromDatabase: async () => {
  const projectId = useProjectStore.getState().activeProjectId;
  const result = await window.api.getAllCVs(projectId); // Pass project filter
  // ...
}
```

### Pattern 3: SQLite Schema Migration

**What:** Version-tracked schema changes using user_version
**When to use:** Adding columns to existing tables
**Example:**
```typescript
// Source: better-sqlite3-migrations pattern
function migrateDatabase(db: Database.Database) {
  const version = db.pragma('user_version', { simple: true }) as number;

  if (version < 1) {
    // Add projects table
    db.exec(`
      CREATE TABLE IF NOT EXISTS projects (
        id TEXT PRIMARY KEY,
        name TEXT NOT NULL,
        client_name TEXT,
        description TEXT,
        is_archived INTEGER DEFAULT 0,
        created_at TEXT NOT NULL,
        updated_at TEXT NOT NULL
      );
    `);

    // Add project_id to existing tables
    db.exec(`ALTER TABLE cvs ADD COLUMN project_id TEXT REFERENCES projects(id)`);
    db.exec(`ALTER TABLE job_descriptions ADD COLUMN project_id TEXT REFERENCES projects(id)`);

    // Create indexes
    db.exec(`CREATE INDEX IF NOT EXISTS idx_cvs_project ON cvs(project_id)`);
    db.exec(`CREATE INDEX IF NOT EXISTS idx_jds_project ON job_descriptions(project_id)`);

    db.pragma('user_version = 1');
  }
}
```

### Pattern 4: shadcn/ui Sidebar Layout

**What:** Collapsible sidebar with icon-only mode
**When to use:** Dashboard navigation
**Example:**
```tsx
// Source: shadcn/ui documentation
import {
  SidebarProvider, Sidebar, SidebarContent, SidebarGroup,
  SidebarMenu, SidebarMenuItem, SidebarMenuButton, SidebarTrigger
} from '@/components/ui/sidebar';
import { LayoutDashboard, FolderKanban, Settings } from 'lucide-react';

function AppSidebar() {
  const navigate = useNavigate();

  const items = [
    { title: 'Dashboard', icon: LayoutDashboard, path: '/' },
    { title: 'Projects', icon: FolderKanban, path: '/projects' },
    { title: 'Settings', icon: Settings, path: '/settings' },
  ];

  return (
    <Sidebar collapsible="icon">
      <SidebarContent>
        <SidebarMenu>
          {items.map((item) => (
            <SidebarMenuItem key={item.title}>
              <SidebarMenuButton onClick={() => navigate(item.path)}>
                <item.icon />
                <span>{item.title}</span>
              </SidebarMenuButton>
            </SidebarMenuItem>
          ))}
        </SidebarMenu>
      </SidebarContent>
    </Sidebar>
  );
}
```

### Anti-Patterns to Avoid

- **Storing project state in URL params only:** Electron apps benefit from memory-based routing; URL is not user-visible
- **Separate databases per project:** Creates file management complexity; use table foreign keys instead
- **Duplicating queue/editor components:** Wrap existing components in project context, don't rebuild
- **Blocking navigation on unsaved state:** Context says "auto-save always" - no unsaved state warnings

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Collapsible sidebar | Custom div with animations | shadcn/ui Sidebar | Handles accessibility, keyboard shortcuts, persistence |
| Client-side routing | Custom view switching logic | react-router-dom MemoryRouter | Handles history, params, navigation guards |
| Schema migrations | Manual ALTER TABLE calls | user_version + migration function | Prevents duplicate migrations, tracks version |
| Card hover states | Custom CSS | Tailwind hover: utilities | Consistent with design system |
| Focus trapping in dialogs | Manual focus management | shadcn/ui Dialog | Radix UI handles accessibility |

**Key insight:** The shadcn/ui component library already has sidebar, card, and dialog primitives that match the terminal dark theme. Installing and customizing these is faster than building from scratch.

## Common Pitfalls

### Pitfall 1: Electron + BrowserRouter

**What goes wrong:** BrowserRouter tries to match file paths like `/path/to/index.html` as routes
**Why it happens:** Electron loads HTML files from filesystem, not a web server
**How to avoid:** Use MemoryRouter or HashRouter exclusively for Electron apps
**Warning signs:** Error "Location did not match any routes" on app load

### Pitfall 2: Foreign Key Cascades on Delete

**What goes wrong:** Deleting a project leaves orphaned CVs/JDs or fails due to FK constraints
**Why it happens:** SQLite foreign keys are disabled by default
**How to avoid:** Enable `PRAGMA foreign_keys = ON` and use `ON DELETE CASCADE`
**Warning signs:** Project delete succeeds but CVs remain; or delete fails silently

### Pitfall 3: Store Subscription Across Stores

**What goes wrong:** queueStore doesn't update when projectStore.activeProjectId changes
**Why it happens:** Zustand stores are independent; no automatic cross-store reactivity
**How to avoid:** Use `useEffect` to reload data when activeProjectId changes, or subscribe manually
**Warning signs:** Project switch doesn't refresh CV list

### Pitfall 4: Missing CSS Variables for Sidebar

**What goes wrong:** Sidebar appears unstyled or with wrong colors
**Why it happens:** shadcn/ui Sidebar expects specific CSS variables (--sidebar, --sidebar-foreground, etc.)
**How to avoid:** Add sidebar CSS variables to globals.css alongside existing theme variables
**Warning signs:** White/light sidebar in dark theme app

### Pitfall 5: Stats Aggregation Performance

**What goes wrong:** Dashboard takes seconds to load with many CVs
**Why it happens:** Counting all CVs/JDs on every dashboard visit
**How to avoid:** Use SQLite COUNT queries with GROUP BY project_id; cache results
**Warning signs:** Visible loading delay on dashboard, especially with 100+ items

## Code Examples

### Database Migration (initDatabase modification)

```typescript
// Source: better-sqlite3 documentation + existing codebase pattern
export function initDatabase(): Database.Database {
  // ... existing init code ...

  // Check schema version and migrate
  const version = db.pragma('user_version', { simple: true }) as number;

  if (version < 1) {
    console.log('Migrating database to version 1 (projects)...');

    // Enable foreign keys
    db.pragma('foreign_keys = ON');

    // Projects table
    db.exec(`
      CREATE TABLE IF NOT EXISTS projects (
        id TEXT PRIMARY KEY,
        name TEXT NOT NULL,
        client_name TEXT,
        description TEXT,
        is_archived INTEGER DEFAULT 0,
        created_at TEXT NOT NULL,
        updated_at TEXT NOT NULL
      );
    `);

    // Add project_id to cvs (nullable for existing data)
    db.exec(`ALTER TABLE cvs ADD COLUMN project_id TEXT REFERENCES projects(id) ON DELETE CASCADE`);

    // Add project_id to job_descriptions
    db.exec(`ALTER TABLE job_descriptions ADD COLUMN project_id TEXT REFERENCES projects(id) ON DELETE CASCADE`);

    // Indexes
    db.exec(`CREATE INDEX IF NOT EXISTS idx_cvs_project ON cvs(project_id)`);
    db.exec(`CREATE INDEX IF NOT EXISTS idx_jds_project ON job_descriptions(project_id)`);

    db.pragma('user_version = 1');
    console.log('Database migrated to version 1');
  }

  return db;
}
```

### Project Store

```typescript
// Source: Zustand documentation
import { create } from 'zustand';

export interface Project {
  id: string;
  name: string;
  client_name?: string;
  description?: string;
  is_archived: boolean;
  created_at: string;
  updated_at: string;
  cv_count?: number;
  jd_count?: number;
}

interface ProjectStore {
  projects: Project[];
  activeProjectId: string | null;
  isLoading: boolean;

  loadProjects: () => Promise<void>;
  selectProject: (id: string | null) => void;
  createProject: (name: string, clientName?: string, description?: string) => Promise<string>;
  updateProject: (id: string, updates: Partial<Project>) => Promise<void>;
  archiveProject: (id: string) => Promise<void>;
  deleteProject: (id: string) => Promise<void>;
}

export const useProjectStore = create<ProjectStore>((set, get) => ({
  projects: [],
  activeProjectId: null,
  isLoading: false,

  loadProjects: async () => {
    set({ isLoading: true });
    try {
      const result = await window.api.getAllProjects();
      if (result.success && result.data) {
        set({ projects: result.data });
      }
    } finally {
      set({ isLoading: false });
    }
  },

  selectProject: (id) => {
    set({ activeProjectId: id });
    // Trigger queue/JD reload via subscription or effect
  },

  createProject: async (name, clientName, description) => {
    const result = await window.api.createProject({ name, client_name: clientName, description });
    if (result.success) {
      await get().loadProjects();
      return result.data.id;
    }
    throw new Error(result.error);
  },

  archiveProject: async (id) => {
    await window.api.updateProject(id, { is_archived: true });
    await get().loadProjects();
  },

  deleteProject: async (id) => {
    await window.api.deleteProject(id);
    if (get().activeProjectId === id) {
      set({ activeProjectId: null });
    }
    await get().loadProjects();
  },
}));
```

### Stats Strip Component

```tsx
// Source: shadcn/ui Card + custom styling
import { Card, CardContent } from '@/components/ui/card';
import { FileText, Briefcase, Clock, Coins } from 'lucide-react';

interface StatsStripProps {
  totalCVs: number;
  totalJDs: number;
  timeSaved: string; // e.g., "2h 15m"
  tokensUsed: number;
}

export function StatsStrip({ totalCVs, totalJDs, timeSaved, tokensUsed }: StatsStripProps) {
  const stats = [
    { label: 'CVs Processed', value: totalCVs, icon: FileText },
    { label: 'Job Descriptions', value: totalJDs, icon: Briefcase },
    { label: 'Time Saved', value: timeSaved, icon: Clock },
    { label: 'Tokens Used', value: tokensUsed.toLocaleString(), icon: Coins },
  ];

  return (
    <div className="flex gap-4 p-4 border-b border-border">
      {stats.map((stat) => (
        <Card key={stat.label} className="flex-1 bg-card">
          <CardContent className="flex items-center gap-3 p-4">
            <stat.icon className="h-8 w-8 text-primary" />
            <div>
              <p className="text-2xl font-bold">{stat.value}</p>
              <p className="text-xs text-muted-foreground">{stat.label}</p>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
```

### Project Card Component

```tsx
// Source: shadcn/ui Card
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { MoreHorizontal, Archive, Trash2 } from 'lucide-react';
import { useNavigate } from 'react-router-dom';

interface ProjectCardProps {
  project: Project;
  onArchive: (id: string) => void;
  onDelete: (id: string) => void;
}

export function ProjectCard({ project, onArchive, onDelete }: ProjectCardProps) {
  const navigate = useNavigate();

  return (
    <Card
      className="bg-card hover:border-primary cursor-pointer transition-colors"
      onClick={() => navigate(`/project/${project.id}`)}
    >
      <CardHeader className="flex flex-row items-start justify-between">
        <div>
          <CardTitle className="text-lg">{project.name}</CardTitle>
          {project.client_name && (
            <CardDescription>{project.client_name}</CardDescription>
          )}
        </div>
        <Button
          variant="ghost"
          size="icon"
          onClick={(e) => { e.stopPropagation(); /* show menu */ }}
        >
          <MoreHorizontal className="h-4 w-4" />
        </Button>
      </CardHeader>
      <CardContent>
        <div className="flex gap-4 text-sm text-muted-foreground">
          <span>{project.cv_count ?? 0} CVs</span>
          <span>{project.jd_count ?? 0} JDs</span>
        </div>
        <p className="text-xs text-muted-foreground mt-2">
          Last activity: {new Date(project.updated_at).toLocaleDateString()}
        </p>
      </CardContent>
    </Card>
  );
}
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| BrowserRouter in Electron | MemoryRouter or HashRouter | React Router v6+ (2022) | Avoids file path matching issues |
| Single monolithic store | Multiple focused stores | Zustand best practice (2023) | Better isolation, performance |
| Manual sidebar toggle | shadcn/ui Sidebar with persist | shadcn Sidebar v2 (2024) | Cookie-based state persistence |
| Raw ALTER TABLE | Migration functions with user_version | SQLite standard | Prevents duplicate migrations |

**Deprecated/outdated:**
- **react-router v5 syntax**: Use v6+ with Routes/Route instead of Switch/Route
- **localStorage in Electron packaged apps**: Can be unreliable; prefer SQLite or electron-store for persistence

## Open Questions

1. **Existing data migration:**
   - What we know: CVs/JDs without project_id need handling
   - What's unclear: Should orphaned data be assigned to a "Default" project or shown separately?
   - Recommendation: Create a "Default Project" on first migration, assign all existing data to it

2. **Stats strip time calculation:**
   - What we know: User wants "2s vs 5 min" comparison (processing time vs industry average)
   - What's unclear: Where does industry average come from? Is it configurable?
   - Recommendation: Use a hardcoded estimate (e.g., 5 min per CV) initially, make configurable later

3. **Project list in sidebar:**
   - What we know: Context says "No recent projects quick access in sidebar"
   - What's unclear: Does sidebar show current project name when inside a project?
   - Recommendation: Claude's discretion - show project name in header/breadcrumb area

## Sources

### Primary (HIGH confidence)
- [shadcn/ui Sidebar](https://ui.shadcn.com/docs/components/sidebar) - Installation, usage, collapsible patterns
- [shadcn/ui Card](https://ui.shadcn.com/docs/components/card) - Card component structure
- [Zustand Slices Pattern](https://zustand.docs.pmnd.rs/guides/slices-pattern) - Store organization
- [Zustand Persist](https://zustand.docs.pmnd.rs/middlewares/persist) - State persistence options
- [React Router Picking a Router](http://reactrouter.docschina.org/routers/picking-a-router/) - MemoryRouter for non-browser

### Secondary (MEDIUM confidence)
- [electron-router-dom](https://github.com/daltonmenezes/electron-router-dom) - HashRouter pattern for Electron verified by multiple sources
- [better-sqlite3-migrations](https://github.com/BlackGlory/better-sqlite3-migrations) - Migration pattern with user_version
- [React Router + Electron discussion](https://github.com/remix-run/react-router/discussions/10724) - BrowserRouter issues in Electron

### Tertiary (LOW confidence)
- PlanRadar dashboard layout reference (user-provided, no URL to verify)
- Time saved calculation methodology (needs clarification from user)

## Metadata

**Confidence breakdown:**
- Standard Stack: HIGH - Using existing installed libraries plus well-documented shadcn/ui components
- Architecture: HIGH - Patterns are standard React/Zustand/SQLite approaches
- Pitfalls: HIGH - Well-documented Electron + React Router issues; SQLite FK behavior

**Research date:** 2026-01-27
**Valid until:** 2026-02-27 (30 days - stable domain, no fast-moving dependencies)
