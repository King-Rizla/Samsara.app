---
phase: 14-mvp-packaging-and-release
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - forge.config.ts
  - src/main/pythonManager.ts
  - src/main/index.ts
  - assets/icon.ico
  - assets/icon.png
autonomous: true

must_haves:
  truths:
    - "mvp branch exists branched from v1 milestone commit c18b1a5"
    - "Sidecar path in pythonManager.ts matches extraResource output path"
    - "DevTools only opens in development mode"
    - "App icon is configured in forge.config.ts for both exe and installer"
    - "better-sqlite3 native module is properly unpacked from asar"
  artifacts:
    - path: "assets/icon.ico"
      provides: "Windows application icon (multi-resolution ICO)"
    - path: "assets/icon.png"
      provides: "Source PNG for icon generation"
  key_links:
    - from: "forge.config.ts"
      to: "assets/icon.ico"
      via: "packagerConfig.icon and MakerSquirrel.setupIcon"
      pattern: "icon.*assets"
    - from: "src/main/pythonManager.ts"
      to: "forge.config.ts extraResource"
      via: "sidecar path must match"
      pattern: "samsara-backend"
---

<objective>
Create the mvp branch from v1 code, fix the sidecar path mismatch bug, guard DevTools for production, add a proper app icon, and ensure native modules work with asar packaging.

Purpose: This is the foundation plan — without a correct build config, the installer will either fail to build or produce a broken app.
Output: A buildable mvp branch with correct forge config, icon, and sidecar path resolution.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-mvp-packaging-and-release/14-RESEARCH.md
@forge.config.ts
@src/main/pythonManager.ts
@src/main/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mvp branch and fix build configuration</name>
  <files>forge.config.ts, src/main/pythonManager.ts, src/main/index.ts</files>
  <action>
    1. Create the mvp branch from the v1 milestone commit:
       ```bash
       git checkout -b mvp c18b1a5
       ```

    2. Fix sidecar path mismatch in `src/main/pythonManager.ts` line 42:
       Change `path.join(process.resourcesPath, "python", exeName)` to `path.join(process.resourcesPath, "samsara-backend", exeName)`.
       The extraResource in forge.config.ts copies `./python-dist/samsara-backend` which lands at `resources/samsara-backend/` in the packaged app.

    3. Guard DevTools in `src/main/index.ts` line 81:
       Wrap `mainWindow.webContents.openDevTools()` with `if (!app.isPackaged)` so end users never see DevTools.

    4. Configure asar unpacking for better-sqlite3 in `forge.config.ts`:
       Add `asarUnpack: ['**/node_modules/better-sqlite3/**']` to `packagerConfig`. This ensures the native .node binary is accessible outside the asar archive.

    5. Configure MakerSquirrel with product metadata:
       Update `new MakerSquirrel({})` to include `name: 'samsara'` and `setupIcon: './assets/icon.ico'`.

    6. Add `packagerConfig.icon: './assets/icon'` (no extension — Electron adds .ico on Windows automatically).

  </action>
  <verify>
    - `git branch --show-current` returns `mvp`
    - `grep "samsara-backend" src/main/pythonManager.ts` shows the corrected path
    - `grep "isPackaged" src/main/index.ts` shows the DevTools guard
    - `grep "asarUnpack" forge.config.ts` shows better-sqlite3 unpacking
    - `grep "setupIcon" forge.config.ts` shows icon config
  </verify>
  <done>mvp branch exists at c18b1a5, sidecar path matches extraResource output, DevTools guarded, asar unpack configured, MakerSquirrel has product metadata</done>
</task>

<task type="auto">
  <name>Task 2: Generate and add application icon</name>
  <files>assets/icon.ico, assets/icon.png</files>
  <action>
    1. Create `assets/` directory if it doesn't exist.

    2. Generate a Samsara app icon as a 1024x1024 PNG. The icon should be a simple, recognizable design:
       - Use the Samsara wheel concept — a circular wheel/dharma wheel motif
       - Purple/violet primary color (#7C3AED or similar) on transparent background
       - Clean, minimal design suitable for small sizes (16x16 to 256x256)
       - Save as `assets/icon.png`

       Since we cannot run graphic design tools in CLI, create a simple SVG first, then convert:
       - Create a minimal SVG with a wheel/circular design using the purple brand color
       - Use `npx png-to-ico` or `npx electron-icon-maker` to convert PNG to ICO

       Alternative approach if image tools unavailable: Use a solid purple circle with "S" letter as a placeholder icon. The key requirement is a valid multi-resolution .ico file.

       If `electron-icon-maker` or `png-to-ico` are not available, use `npx sharp-cli` or write a small Node script using the `sharp` library (already commonly available) to:
       - Create a 256x256 purple circle PNG
       - Convert to ICO format using `to-ico` npm package

    3. Verify the .ico file is valid and contains multiple resolutions (at minimum 256x256).

  </action>
  <verify>
    - `ls assets/icon.ico` exists
    - `ls assets/icon.png` exists
    - File size of icon.ico is > 1KB (not an empty/corrupt file)
  </verify>
  <done>Valid multi-resolution .ico file exists at assets/icon.ico, source PNG exists at assets/icon.png</done>
</task>

</tasks>

<verification>
- `git log --oneline -1` on mvp branch shows it's based on v1 code
- `grep -n "samsara-backend" src/main/pythonManager.ts` shows corrected path on line 42
- `grep -n "isPackaged" src/main/index.ts` shows DevTools guard
- `ls assets/icon.ico` confirms icon exists
- `npx tsc --noEmit` passes (TypeScript still compiles)
</verification>

<success_criteria>
mvp branch exists from c18b1a5 with all build configuration fixes applied: sidecar path corrected, DevTools guarded, asar unpack configured, app icon present and referenced in forge config. TypeScript compiles cleanly.
</success_criteria>

<output>
After completion, create `.planning/phases/14-mvp-packaging-and-release/14-01-SUMMARY.md`
</output>
